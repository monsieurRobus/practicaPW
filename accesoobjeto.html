<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>acceso</title>
	<link rel="stylesheet" href="css/estilos.css">

	<script>

var intentos=2;

var ubloqueo=0;


function acceder(){

       		if (ubloqueo==0){

              if (document.form.usuario.value=="" || document.form.contrasena.value==""){
            
                  alert("Debes escribir un usuario y un password");
                  document.form.usuario.focus(); 
                  return ;
              };

       			for (var total=0; total < localStorage.length; total++){

       				var usuario1=localStorage.key(total); // valor de clave localStorage

	   				var usuario2=localStorage[localStorage.key(total)]; // cadena de la clave localStorage

	   				var usuario3=JSON.parse(usuario2); // convierte la cadena en un objeto de nuevo


       					if (document.form.usuario.value==usuario3.usuario){ 

 //      						alert(total);

 //      						alert("El usuario es correcto");

       								if (document.form.contrasena.value==usuario3.contrasena){ 

 //      									alert("El password es correcto");

       									var variable=1;



       								}else{
       									var variable=2;     									
       								};


       						break;

       					}else{
       						var variable=0;
       					};

       			};

       			if (variable==0){
       				alert("El usuario no existe");
       				document.form.usuario.value = "";
         			document.form.contrasena.value = "";
         			document.form.usuario.focus();

       			};

       			if (variable==1){
       				alert("acceso permitido");
       				location.href="mapa.html";
       			}

       			if (variable==2){
       				if (intentos==0){
       					alert("Lo sentimos. Cuenta Bloqueada. Pongase en contacto con el administrador");
       					document.form.usuario.value = "";
         				document.form.contrasena.value = "";
         				ubloqueo=1;

       				}else{
       					alert("El password no es correcto. Le quedan "+intentos+" oportunidades");
       					intentos--;
         				document.form.contrasena.value = "";
         				document.form.contrasena.focus(); 

       				}
       			}

       	}else{
       		   alert("Lo sentimos. Cuenta Bloqueada. Pongase en contacto con el administrador");
       	}
};

	</script>

</head>
<body>

	<header>
		<a href="index.html" id="inmo">INMO GRU3P</a>
		<p>La mejor oferta de vivienda en España</p>
	</header>

	<section id="usuario">
		<p id="acceso">INICIAR SESION</p>
		
		<form action="" name=form method="get">

			<input type="text" id="usuario" name=usuario placeholder="Usuario">
			<input type="password" id="contrasena" name=contrasena placeholder="Contraseña">
			<input type="button" value="Aceptar" onclick= acceder()>

		</form>

	</section>
	
</body>
</html>